<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/main.css" />
    <title>EJS ì‚¬ìš©í•´ì„œ listí˜ì´ì§€ ë§Œë“¬</title>
  </head>
  <body class="grey-bg">
    <!-- include : 'nav.ejsíŒŒì¼ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•´ì£¼ì„¸ìš”.' ë¼ëŠ” ë¬¸ë²• -->
    <%- include('nav.ejs') %>

    <div class="search-container">
        <input type="text" id="search-text">
        <button type="submit" id="search-btn">ê²€ìƒ‰</button>
    </div>

    <div class="white-bg">
      <% for (let i=0; i < list.length; i++){ %>
      <div class="list-box">
        <h4>
          <a href="/detail/<%= list[i]._id %>"><%= list[i].title %></a>
          <a href="/edit/<%= list[i]._id %>">âœï¸</a>
          <span class="delete" data-id="<%= list[i]._id %>">ğŸ—‘ï¸</span>
        </h4>
        <p><%= list[i].content %></p>
      </div>
      <% } %>
    </div>

    <div class="pagination-box">
      <!-- 1,2,3...í˜ì´ì§€ ë²„íŠ¼ -->
      <a href="/list/1" class="btn btn-primary">1</a>
      <a href="/list/2" class="btn btn-primary">2</a>
      <a href="/list/3" class="btn btn-primary">3</a>
      <!-- list ë‹¤ìŒí˜ì´ì§€ ë²„íŠ¼ -->
      <a href="/list/next/<%= list[ list.length - 1 ]._id %>" class="btn btn-primary">next</a>
    </div>

    <!-- 
        ejs ì¤‘ìš” ë¬¸ë²• 3ê°€ì§€
        1. <% %> == html ì‚¬ì´ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²• ì‚¬ìš©í•  ë•Œ
        2. <%- %> == includeê°™ì€ ë¬¸ë²• ì‚¬ìš©í•  ë•Œ
        3. <%= %> == htmlíƒœê·¸ë¥¼ ì‹¤ì œ íƒœê·¸ê°€ ì•„ë‹Œ stringìœ¼ë¡œ ë³€í™˜í•´ì„œ ë§Œë“¤ì–´ì¤Œ
    -->

    <!-- 
      ajaxë¥¼ ì‚¬ìš©í•´ì„œ ìƒˆë¡œê³ ì¹¨ ì—†ì´ requestí•˜ê¸°
      1. scriptë¥¼ ì—´ì–´ì„œ addEventListener ì½œë°±í•¨ìˆ˜ì— fetchí•¨ìˆ˜ ì‚¬ìš© >> fetchí•¨ìˆ˜ì— urlì„ ì ìœ¼ë©´ ì„œë²„ì— getìš”ì²­ì„ ë‚ ë ¤ì¤Œ
      2. ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ê°ì²´ë¬¸ë²•ìœ¼ë¡œ method ì§€ì •ê°€ëŠ¥ >> method : 'PUT'
      3. ajaxë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê³  ì‹¶ìœ¼ë©´?
        headers : {'Content-Type' : 'application/json '},
        body : ë°ì´í„°ë“¤ >> obj,arrë¥¼ ë³´ë‚´ê³  ì‹¶ìœ¼ë©´ JSON.stringify({title : nike}) ì²˜ëŸ¼ ë³´ë‚´ì£¼ì…ˆ

      ps. queryë¬¸ë²•ìœ¼ë¡œ ë°ì´í„° ë„£ê¸°
        url?ë°ì´í„°ëª…=ë°ì´í„°ê°’ >> /abc?name=dongmin
          &ê¸°í˜¸ë¡œ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŒ >> /abc?name=dongmin&age=29
        
        serverì—ì„œ queryë¬¸ë²•ìœ¼ë¡œ ë³´ë‚¸ ë°ì´í„° ì¶œë ¥ì€ req.queryë¡œ ê°€ëŠ¥
     -->

     <!-- 
      ë¬¸ì œ ë°œìƒ : JSì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ iëŠ” ejsë¬¸ë²•ì—ì„œ ì½ì„ ìˆ˜ê°€ ì—†ìŒ
      í•´ê²° : forë¬¸ì„ ejsë¡œ ì‘ì„±í•˜ê³ , ë‚˜ë¨¸ì§€ jsëŠ” scriptì— ì‘ì„±í•¨.
            ë³€ìˆ˜ iëŠ” ejsì—ì„œ ì„ ì–¸í•˜ì˜€ìœ¼ë¯€ë¡œ ejsë¬¸ë²•ìœ¼ë¡œ ì¤‘ê°„ì— ì‚¬ìš©!
    -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js' integrity='sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==' crossorigin='anonymous'></script>

    <script>
      for (let i=0; i < '<%= list.length %>';i++){
        console.log(i)
        document.querySelectorAll('.delete')[i].addEventListener('click', function(e){
          const datasetId = e.target.dataset.id;
          const dataParent = e.target.parentElement;
          console.log(datasetId)
          fetch('/delete?docid=' + datasetId, {
            method : 'DELETE'
          })
          // ajax ì„±ê³µ ì‹œ ì„œë²„ê°€ ë³´ë‚¸ ë°ì´í„° ê°™ì€ ê²ƒë„ ì¶œë ¥ì´ ê°€ëŠ¥í•˜ë‹¤.
          // í˜„ì¬ server.jsì—ì„œ /delete, delete ìš”ì²­ ì‹œ 'ì‚­ì œì™„ë£Œ'ë¼ëŠ” stringì„ sendí•˜ê³  ìˆë‹¤.
          // ë§Œì•½ ì„œë²„ê°€ ë³´ë‚´ëŠ” ë°ì´í„°ê°€ arr, objì¼ ê²½ìš° .then((r)=>r.json())ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì–´ì•¼ í•œë‹¤.
          // í…ìŠ¤íŠ¸, arr, objë“± ë°ì´í„°ê°€ ë“¤ì–´ìˆëŠ” í•¨ìˆ˜ëŠ” r ì´ë‹¤.
          // ajaxë¥¼ ì‚¬ìš©í•  ë•Œì—ëŠ” ê·¸ëƒ¥ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì“°ëŠ” ê²Œ ì ¤ ë‚˜ìŒ. >> axiosë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤ê³  í•¨
          .then((r)=>r.text())
          .then((r)=>{ console.log(r) /**ì—¬ê¸°ì„œ r.title, r.content ë“± deleteê°€ ì„±ê³µí•˜ë©´ ajaxë¡œ ë°ì´í„° ë¶ˆëŸ¬ì™€ì„œ ì‘ì„±í•˜ë©´ ë¨ */
            dataParent.parentElement.remove();
          })
        })
      }
      // ì˜ˆì™¸ì²˜ë¦¬ í•˜ëŠ” ë²•!
      // fetch('/')
      // .then((r)=>{
      //   if(r.status == 200) {
      //     return r.json()
      //   } else {
      //     // ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œ ì „ì†¡ ì‹œ ì‹¤í–‰í•  ì½”ë“œ
      //     alert('error!')
      //   }
      // })
      // .then((result)=>{
      //   // ì„±ê³µ ì‹œ ì‹¤í–‰í•  ì½”ë“œ
      // }).catch((error)=>{
      //   // ì¸í„°ë„· ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ ì‹œ ì‹¤í–‰í•  ì½”ë“œ
      //   console.log(error)
      // })

      document.querySelector('#search-btn').addEventListener('click', function(){
        let result = document.querySelector('#search-text').value
        location.href = '/search?val=' + result
        console.log(result)
      })
      </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
